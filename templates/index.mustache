{{> header}}

<style>
    .day-chooser, .threshold-chooser {
        width: 100%;
    }
</style>

<div class="row-fluid">
    <div class="span4 offset2">
        <button class="threshold-chooser btn" data-threshold="10">Top 10</button><br>
        <button class="threshold-chooser btn" data-threshold="25">Top 25</button><br>
        <button class="threshold-chooser btn" data-threshold="50">Top 50</button><br>
        <button class="threshold-chooser btn" data-threshold="100">Top 100</button><br>
        <button class="threshold-chooser btn" data-threshold="300">Top 300</button><br>
    </div>

    <div class="span4">
        <button class="day-chooser btn" data-day="0">Sunday</button><br>
        <button class="day-chooser btn" data-day="1">Monday</button><br>
        <button class="day-chooser btn" data-day="2">Tuesday</button><br>
        <button class="day-chooser btn" data-day="3">Wednesday</button><br>
        <button class="day-chooser btn" data-day="4">Thursday</button><br>
        <button class="day-chooser btn" data-day="5">Friday</button><br>
        <button class="day-chooser btn" data-day="6">Saturday</button><br>
    </div>

    <div class="span2">
        <span style="font-weight: bold; font-size: 5em;">‚Üê</span> 
        <span style="font-size: 3em;">UTC</span>
    </div>
</div>

<hr>

<div id="posts" class="row-fluid"></div>


<script type="text/javascript">
    var fetch_posts = function() {
        var threshold = localStorage.getItem("threshold");
        var day = localStorage.getItem("day");

        jQuery.get(
            "/posts.json", 
            {
                threshold: threshold,
                day: day
            },
            function(data) {
                data.domain = window.location.host;
                data.threshold = threshold;
                data.day = day;
                var posts_html = ich.posts_tpl(data);
                jQuery("#posts").html(posts_html);
            }
        );
        jQuery("#posts").html("").spin("large");
    }

    jQuery(document).ready(function() {
        var threshold = localStorage.getItem("threshold");
        jQuery(".threshold-chooser").each(function() {
            if(
                jQuery(this).attr("data-threshold") === threshold
                || !threshold && jQuery(this).attr("data-threshold") == 25
            ) {
                jQuery(this).addClass("btn-primary");
            }
        });

        var day = localStorage.getItem("day");
        jQuery(".day-chooser").each(function() {
            if(
                jQuery(this).attr("data-day") === day
                || (!day && jQuery(this).attr("data-day") == new Date().getUTCDay())
            ) {
                jQuery(this).addClass("btn-primary");
            }
        });

        fetch_posts();

        jQuery(".threshold-chooser").on("click", function() {
            jQuery(".threshold-chooser").each(function() {
                jQuery(this).removeClass("btn-primary");
            });
            jQuery(this).addClass("btn-primary");
            var threshold = jQuery(this).attr("data-threshold");
            localStorage.setItem("threshold", threshold);
            fetch_posts();
        });
        jQuery(".day-chooser").on("click", function() {
            jQuery(".day-chooser").each(function() {
                jQuery(this).removeClass("btn-primary");
            });
            jQuery(this).addClass("btn-primary");
            var day = jQuery(this).attr("data-day");
            localStorage.setItem("day", day);
            fetch_posts();
        });
    });
</script>

{{=|a| |a|=}}
<script id="posts_tpl" type="text/html">
    <p>
        <img src="/img/rss.svg" width="20px"> <a href="http://{{domain}}/feed.xml?threshold={{threshold}}&day={{day}}">
            http://{{domain}}/feed.xml?threshold={{threshold}}&day={{day}}
        </a>
    </p>

    <h2>Your sample posts</h2>
    {{#posts}}
        <article>
            <header>
                <h3><a href="{{url}}">{{title}}</a></h3>
                 {{domain}}
            </header>
            <p>
                {{points}} Points 
                | <a href="{{permalink}}">{{num_comments}} Comments</a> 
                | Created on {{rss_date}}
            </p>
        </article>
    {{/posts}}
</script>
|a|={{ }}=|a|

{{> footer}}
